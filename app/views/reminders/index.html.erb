<!-- Theme Switcher -->
<div class="theme-switcher">
  <span class="theme-switcher-label">Theme:</span>
  <button class="theme-toggle-button" onclick="toggleTheme()">
    <span class="theme-icon" id="themeIcon">üåô</span>
    <span id="themeText">Dark</span>
  </button>
</div>

<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1 style="color: var(--text-primary); font-size: 2.5em;">‚è∞ Reminders</h1>
    <%= link_to "‚Üê Home", homes_path, class: "btn-back", style: "text-decoration: none; background: var(--accent-primary); color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold;" %>
  </div>

  <!-- Add New Reminder Form -->
  <div style="background: var(--accent-primary); padding: 25px; border-radius: 10px; margin-bottom: 30px; color: white;">
    <h3 style="margin-bottom: 15px;">‚ûï Add New Reminder</h3>
    <%= form_with model: @reminder, local: true do %>
      <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <%= label_tag 'reminder[title]', "Title *", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= text_field_tag 'reminder[title]', nil, required: true, placeholder: "e.g., Return Library Book", style: "width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 1em; color: #2c3e50;" %>
        </div>
        <div>
          <%= label_tag 'reminder[alarm_time]', "Alarm Time *", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= datetime_field_tag 'reminder[alarm_time]', nil, required: true, style: "width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 1em; color: #2c3e50;" %>
        </div>
      </div>
      <div style="margin-bottom: 15px;">
        <%= label_tag 'reminder[description]', "Description", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
        <%= text_area_tag 'reminder[description]', nil, rows: 2, placeholder: "Additional details...", style: "width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 1em; color: #2c3e50;" %>
      </div>
      <%= submit_tag "Add Reminder", style: "background: white; color: var(--accent-primary); padding: 12px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1em;" %>
    <% end %>
  </div>

  <!-- Reminders List -->
  <div style="background: var(--bg-secondary); padding: 30px; border-radius: 10px; box-shadow: var(--shadow-md);">
    <h3 style="color: var(--text-primary); margin-bottom: 20px;">üìã My Reminders</h3>
    
    <% if @reminders.empty? %>
      <p style="text-align: center; color: var(--text-secondary); padding: 30px;">No reminders added yet.</p>
    <% else %>
      <div style="display: grid; gap: 15px;">
        <% @reminders.each do |reminder| %>
          <% is_past = reminder.alarm_time < Time.current %>
          <% is_active = reminder.is_active %>
          
          <div style="border: 2px solid <%= is_active ? 'var(--accent-primary)' : '#C85A54' %>; border-radius: 10px; padding: 20px; background: var(--bg-tertiary); position: relative; opacity: <%= is_past ? '0.7' : '1' %>;">
            <div style="display: flex; justify-content: between; align-items: start; gap: 20px;">
              <!-- Alarm Status -->
              <div style="flex-shrink: 0;">
                <%= link_to toggle_alarm_reminder_path(reminder), method: :patch, style: "text-decoration: none; display: block;" do %>
                  <div style="width: 60px; height: 60px; border-radius: 50%; background: <%= is_active ? 'var(--accent-primary)' : '#C85A54' %>; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8em; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    <%= is_active ? 'üîî' : 'üîï' %>
                  </div>
                <% end %>
                <small style="display: block; text-align: center; margin-top: 5px; color: <%= is_active ? 'var(--accent-primary)' : '#C85A54' %>; font-weight: bold;">
                  <%= is_active ? 'Active' : 'Off' %>
                </small>
              </div>

              <!-- Reminder Info -->
              <div style="flex: 1;">
                <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 1.3em;"><%= reminder.title %></h4>
                
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <span style="background: <%= is_past ? 'var(--btn-secondary-bg)' : 'var(--accent-primary)' %>; color: white; padding: 5px 12px; border-radius: 5px; font-size: 0.9em; font-weight: bold;">
                    ‚è∞ <%= reminder.alarm_time.strftime('%d.%m.%Y %H:%M') %>
                  </span>
                  <% if is_past %>
                    <span style="color: #C85A54; font-weight: bold; font-size: 0.9em;">‚ö†Ô∏è Passed</span>
                  <% else %>
                    <% time_diff = ((reminder.alarm_time - Time.current) / 3600).round %>
                    <% if time_diff < 24 %>
                      <span style="color: #C85A54; font-weight: bold; font-size: 0.9em;">üî• In <%= time_diff %> <%= time_diff == 1 ? 'hour' : 'hours' %></span>
                    <% end %>
                  <% end %>
                </div>
                
                <% if reminder.description.present? %>
                  <p style="color: var(--text-secondary); margin: 8px 0 0 0;">
                    <%= reminder.description %>
                  </p>
                <% end %>
              </div>

              <!-- Actions -->
              <div style="display: flex; gap: 8px; flex-shrink: 0;">
                <%= link_to "<i class="fa-solid fa-pencil"></i>", edit_reminder_path(reminder), style: "text-decoration: none; font-size: 1.3em; padding: 5px;", title: "Edit" %>
                <%= link_to "<i class="fa-solid fa-trash"></i>", reminder_path(reminder), method: :delete, data: { confirm: "Are you sure you want to delete this reminder?" }, style: "text-decoration: none; font-size: 1.3em; padding: 5px;", title: "Delete" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<style>
  .alarm-toggle:hover {
    transform: scale(1.1);
  }
</style>

<script>
  // Theme switcher functionality
  function getTheme() {
    return localStorage.getItem('theme') || 'light';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButton(theme);
  }

  function updateThemeButton(theme) {
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    
    if (theme === 'dark') {
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
      themeText.textContent = 'Light';
    } else {
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
      themeText.textContent = 'Dark';
    }
  }

  function toggleTheme() {
    const currentTheme = getTheme();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
  }

  (function initTheme() {
    const savedTheme = getTheme();
    setTheme(savedTheme);
  })();

  // Floating menu control
  function toggleFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    const isVisible = menu.style.display === 'block';
    
    if (isVisible) {
      closeFloatingMenu();
    } else {
      openFloatingMenu();
    }
  }

  function openFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    const items = menu.querySelectorAll('.menu-item');
    
    menu.style.display = 'block';
    void menu.offsetWidth;
    
    setTimeout(() => {
      menu.classList.add('show');
      items.forEach(item => {
        item.classList.add('animate');
      });
    }, 10);
  }

  function closeFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    if (menu) {
      const items = menu.querySelectorAll('.menu-item');
      
      menu.classList.remove('show');
      items.forEach(item => {
        item.classList.remove('animate');
      });
      
      setTimeout(() => {
        menu.style.display = 'none';
      }, 300);
    }
  }

  // Close menu when clicking outside
  document.addEventListener('click', function(event) {
    const menu = document.getElementById('floatingMenu');
    const button = document.getElementById('floatingButton');
    
    if (menu && button && !menu.contains(event.target) && !button.contains(event.target)) {
      closeFloatingMenu();
    }
  });

  // Close menu with ESC key
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      closeFloatingMenu();
    }
  });

  // Hover functionality for floating button
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('floatingButton');
    const menu = document.getElementById('floatingMenu');
    
    if (button && menu) {
      // Show menu on button hover
      button.addEventListener('mouseenter', function() {
        openFloatingMenu();
      });
      
      // Keep menu open when hovering over menu
      menu.addEventListener('mouseenter', function() {
        openFloatingMenu();
      });
      
      // Close menu when leaving button (if not entering menu)
      button.addEventListener('mouseleave', function() {
        setTimeout(function() {
          if (!menu.matches(':hover') && !button.matches(':hover')) {
            closeFloatingMenu();
          }
        }, 100);
      });
      
      // Close menu when leaving menu (if not entering button)
      menu.addEventListener('mouseleave', function() {
        setTimeout(function() {
          if (!menu.matches(':hover') && !button.matches(':hover')) {
            closeFloatingMenu();
          }
        }, 100);
      });
    }
  });
</script>

<!-- Floating Menu Button -->
<div id="floatingButton" onclick="toggleFloatingMenu()" class="floating-button">
  <span style="color: white; font-size: 1.5em; font-weight: bold;"><i class="fa-solid fa-bookmark"></i></span>
</div>

<!-- Floating Menu -->
<div id="floatingMenu" class="floating-menu">
  <h3 class="floating-menu-title">Study Tools</h3>
  
  <%= link_to homes_path, class: "menu-item" do %>
    <span class="menu-icon">üè†</span>
    <div class="menu-text">
      <strong>Home</strong>
      <small>Timers & Notes</small>
    </div>
  <% end %>
  
  <%= link_to study_materials_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-pen-to-square"></i></span>
    <div class="menu-text">
      <strong>My Study Materials</strong>
      <small>PDF and image upload</small>
    </div>
  <% end %>
  
  <%= link_to flashcard_collections_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-repeat"></i></span>
    <div class="menu-text">
      <strong>Flashcards</strong>
      <small>Card collections</small>
    </div>
  <% end %>
  
  <%= link_to agendas_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-calendar-days"></i></span>
    <div class="menu-text">
      <strong>My Agenda</strong>
      <small>Event calendar</small>
    </div>
  <% end %>
</div>
