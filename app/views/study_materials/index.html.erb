<!-- Theme Switcher -->
<div class="theme-switcher">
  <span class="theme-switcher-label">Theme:</span>
  <button class="theme-toggle-button" onclick="toggleTheme()">
    <span class="theme-icon" id="themeIcon">üåô</span>
    <span id="themeText">Dark</span>
  </button>
</div>

<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1 style="color: var(--text-primary); font-size: 2.5em;"><i class="fa-solid fa-pen-to-square"></i> My Study Materials</h1>
    <%= link_to "‚Üê Home", homes_path, class: "btn-back", style: "text-decoration: none; background: var(--accent-primary); color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold;" %>
  </div>

  <div style="margin-bottom: 30px;">
    <%= link_to "+ Add New Study Material", new_study_material_path, class: "btn-add", style: "text-decoration: none; background: var(--accent-primary); color: white; padding: 15px 30px; border-radius: 8px; font-weight: bold; display: inline-block;" %>
  </div>

  <% if @study_materials.empty? %>
    <div style="background: var(--bg-tertiary); padding: 40px; border-radius: 10px; text-align: center;">
      <p style="font-size: 1.2em; color: var(--text-secondary);">No study materials added yet. You can add new materials using the button above.</p>
    </div>
  <% else %>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
      <% @study_materials.each do |material| %>
        <div style="background: var(--bg-secondary); border-radius: 10px; box-shadow: var(--shadow-md); padding: 20px; transition: transform 0.2s; border: 1px solid var(--border-color);" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
          <h3 style="color: var(--text-primary); margin-bottom: 10px; font-size: 1.3em;"><%= material.title %></h3>
          
          <% if material.category.present? %>
            <span style="background: var(--accent-primary); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; display: inline-block; margin-bottom: 10px;">
              <%= material.category %>
            </span>
          <% end %>
          
          <% if material.description.present? %>
            <p style="color: var(--text-secondary); margin: 10px 0; font-size: 0.95em;">
              <%= truncate(material.description, length: 100) %>
            </p>
          <% end %>
          
          <% if material.files.attached? %>
            <div style="margin: 15px 0; padding: 10px; background: var(--bg-tertiary); border-radius: 5px; border: 1px solid var(--border-color);">
              <strong style="color: var(--text-primary);">üìé Files (<%= material.files.count %>)</strong>
            </div>
          <% end %>
          
          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <%= link_to "View", study_material_path(material), style: "flex: 1; text-align: center; background: var(--accent-primary); color: white; padding: 10px; border-radius: 5px; text-decoration: none; font-weight: bold;" %>
            <%= link_to "Edit", edit_study_material_path(material), style: "flex: 1; text-align: center; background: var(--btn-secondary-bg); color: var(--btn-secondary-text); padding: 10px; border-radius: 5px; text-decoration: none; font-weight: bold;" %>
            <%= link_to "Delete", study_material_path(material), method: :delete, data: { confirm: "Are you sure you want to delete?" }, style: "flex: 1; text-align: center; background: #C85A54; color: white; padding: 10px; border-radius: 5px; text-decoration: none; font-weight: bold;" %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  // Theme switcher functionality
  function getTheme() {
    return localStorage.getItem('theme') || 'light';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButton(theme);
  }

  function updateThemeButton(theme) {
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    
    if (theme === 'dark') {
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
      themeText.textContent = 'Light';
    } else {
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
      themeText.textContent = 'Dark';
    }
  }

  function toggleTheme() {
    const currentTheme = getTheme();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
  }

  (function initTheme() {
    const savedTheme = getTheme();
    setTheme(savedTheme);
  })();

  // Floating menu control
  function toggleFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    const isVisible = menu.style.display === 'block';
    
    if (isVisible) {
      closeFloatingMenu();
    } else {
      openFloatingMenu();
    }
  }

  function openFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    const items = menu.querySelectorAll('.menu-item');
    
    menu.style.display = 'block';
    void menu.offsetWidth;
    
    setTimeout(() => {
      menu.classList.add('show');
      items.forEach(item => {
        item.classList.add('animate');
      });
    }, 10);
  }

  function closeFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    if (menu) {
      const items = menu.querySelectorAll('.menu-item');
      
      menu.classList.remove('show');
      items.forEach(item => {
        item.classList.remove('animate');
      });
      
      setTimeout(() => {
        menu.style.display = 'none';
      }, 300);
    }
  }

  // Close menu when clicking outside
  document.addEventListener('click', function(event) {
    const menu = document.getElementById('floatingMenu');
    const button = document.getElementById('floatingButton');
    
    if (menu && button && !menu.contains(event.target) && !button.contains(event.target)) {
      closeFloatingMenu();
    }
  });

  // Close menu with ESC key
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      closeFloatingMenu();
    }
  });

  // Hover functionality for floating button
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('floatingButton');
    const menu = document.getElementById('floatingMenu');
    
    if (button && menu) {
      // Show menu on button hover
      button.addEventListener('mouseenter', function() {
        openFloatingMenu();
      });
      
      // Keep menu open when hovering over menu
      menu.addEventListener('mouseenter', function() {
        openFloatingMenu();
      });
      
      // Close menu when leaving button (if not entering menu)
      button.addEventListener('mouseleave', function() {
        setTimeout(function() {
          if (!menu.matches(':hover') && !button.matches(':hover')) {
            closeFloatingMenu();
          }
        }, 100);
      });
      
      // Close menu when leaving menu (if not entering button)
      menu.addEventListener('mouseleave', function() {
        setTimeout(function() {
          if (!menu.matches(':hover') && !button.matches(':hover')) {
            closeFloatingMenu();
          }
        }, 100);
      });
    }
  });
</script>

<!-- Floating Menu Button -->
<div id="floatingButton" onclick="toggleFloatingMenu()" class="floating-button">
  <span style="color: white; font-size: 1.5em; font-weight: bold;"><i class="fa-solid fa-bookmark"></i></span>
</div>

<!-- Floating Menu -->
<div id="floatingMenu" class="floating-menu">
  <h3 class="floating-menu-title">Study Tools</h3>
  
  <%= link_to homes_path, class: "menu-item" do %>
    <span class="menu-icon">üè†</span>
    <div class="menu-text">
      <strong>Home</strong>
      <small>Timers & Notes</small>
    </div>
  <% end %>
  
  <%= link_to flashcard_collections_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-repeat"></i></span>
    <div class="menu-text">
      <strong>Flashcards</strong>
      <small>Card collections</small>
    </div>
  <% end %>
  
  <%= link_to agendas_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-calendar-days"></i></span>
    <div class="menu-text">
      <strong>My Agenda</strong>
      <small>Event calendar</small>
    </div>
  <% end %>
  
  <%= link_to reminders_path, class: "menu-item" do %>
    <span class="menu-icon"><i class="fa-solid fa-stopwatch"></i></span>
    <div class="menu-text">
      <strong>Reminders</strong>
      <small>Alarms and notes</small>
    </div>
  <% end %>
</div>
