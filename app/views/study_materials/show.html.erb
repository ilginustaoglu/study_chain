<!-- Theme Switcher -->
<div class="theme-switcher">
  <span class="theme-switcher-label">Theme:</span>
  <button class="theme-toggle-button" onclick="toggleTheme()">
    <span class="theme-icon" id="themeIcon">üåô</span>
    <span id="themeText">Dark</span>
  </button>
</div>

<div class="container" style="max-width: 900px; margin: 40px auto; padding: 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1 style="color: var(--text-primary); font-size: 2.5em;"><%= @study_material.title %></h1>
    <%= link_to "‚Üê Back", study_materials_path, class: "btn-back", style: "text-decoration: none; background: var(--accent-primary); color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold;" %>
  </div>

  <div style="background: var(--bg-secondary); padding: 30px; border-radius: 10px; box-shadow: var(--shadow-md);">
    <% if @study_material.category.present? %>
      <div style="margin-bottom: 20px;">
        <span style="background: var(--accent-primary); color: white; padding: 8px 15px; border-radius: 5px; font-size: 0.9em; font-weight: bold;">
          üìÇ <%= @study_material.category %>
        </span>
      </div>
    <% end %>

    <% if @study_material.description.present? %>
      <div style="margin-bottom: 30px; padding: 20px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
        <h3 style="color: var(--text-primary); margin-bottom: 10px;">Description:</h3>
        <p style="color: var(--text-secondary); line-height: 1.6; white-space: pre-wrap;"><%= @study_material.description %></p>
      </div>
    <% end %>

    <% if @study_material.files.attached? %>
      <div style="margin-top: 30px;">
        <h3 style="color: var(--text-primary); margin-bottom: 15px;">üìé Attached Files (<%= @study_material.files.count %>):</h3>
        <div style="display: grid; gap: 15px;">
          <% @study_material.files.each do |file| %>
            <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 2px solid var(--border-color);">
              <div>
                <% if file.content_type.start_with?('image/') %>
                  <span style="font-size: 1.5em;">üñºÔ∏è</span>
                <% elsif file.content_type == 'application/pdf' %>
                  <span style="font-size: 1.5em;">üìÑ</span>
                <% else %>
                  <span style="font-size: 1.5em;">üìé</span>
                <% end %>
                <strong style="margin-left: 10px; color: var(--text-primary);"><%= file.filename %></strong>
                <span style="color: var(--text-secondary); margin-left: 10px; font-size: 0.9em;">
                  (<%= number_to_human_size(file.byte_size) %>)
                </span>
              </div>
              <div style="display: flex; gap: 10px;">
                <%= link_to "Download", rails_blob_path(file, disposition: "attachment"), style: "background: var(--accent-primary); color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-weight: bold;" %>
                <%= link_to "üóëÔ∏è Delete", remove_file_study_material_path(@study_material, file_id: file.id), method: :delete, data: { confirm: "Are you sure you want to delete this file?" }, style: "background: #e74c3c; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-weight: bold;" %>
              </div>
            </div>
            
            <% if file.content_type.start_with?('image/') %>
              <div style="margin-top: 10px; text-align: center;">
                <%= image_tag file, style: "max-width: 100%; border-radius: 8px; box-shadow: var(--shadow-md);" %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <div style="display: flex; gap: 15px; margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--border-color);">
      <%= link_to "Edit", edit_study_material_path(@study_material), style: "flex: 1; text-align: center; background: var(--btn-secondary-bg); color: var(--btn-secondary-text); padding: 15px; border-radius: 8px; text-decoration: none; font-weight: bold;" %>
      <%= link_to "Delete", study_material_path(@study_material), method: :delete, data: { confirm: "Are you sure you want to delete this study material?" }, style: "flex: 1; text-align: center; background: #e74c3c; color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: bold;" %>
    </div>
  </div>
</div>

<script>
  // Theme switcher functionality
  function getTheme() {
    return localStorage.getItem('theme') || 'light';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButton(theme);
  }

  function updateThemeButton(theme) {
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    
    if (theme === 'dark') {
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
      themeText.textContent = 'Light';
    } else {
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
      themeText.textContent = 'Dark';
    }
  }

  function toggleTheme() {
    const currentTheme = getTheme();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
  }

  (function initTheme() {
    const savedTheme = getTheme();
    setTheme(savedTheme);
  })();
</script>
