<!-- Theme Switcher -->
<div class="theme-switcher">
  <span class="theme-switcher-label">Theme:</span>
  <button class="theme-toggle-button" onclick="toggleTheme()">
    <span class="theme-icon" id="themeIcon">üåô</span>
    <span id="themeText">Dark</span>
  </button>
</div>

<div class="container" style="max-width: 800px; margin: 40px auto; padding: 20px;">
  <h1 style="color: var(--text-primary); font-size: 2.5em; margin-bottom: 30px;"><i class="fa-solid fa-pencil"></i> Edit Study Material</h1>

  <%= form_with model: @study_material, local: true, multipart: true, style: "background: var(--bg-secondary); padding: 30px; border-radius: 10px; box-shadow: var(--shadow-md);" do |f| %>
    <div style="margin-bottom: 20px;">
      <%= f.label :title, "Title *", style: "display: block; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;" %>
      <%= f.text_field :title, required: true, style: "width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 5px; font-size: 1em; background: var(--bg-tertiary); color: var(--text-primary);" %>
    </div>

    <div style="margin-bottom: 20px;">
      <%= f.label :category, "Category", style: "display: block; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;" %>
      <%= f.text_field :category, placeholder: "e.g., Math, Physics, etc.", style: "width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 5px; font-size: 1em; background: var(--bg-tertiary); color: var(--text-primary);" %>
    </div>

    <div style="margin-bottom: 20px;">
      <%= f.label :description, "Description", style: "display: block; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;" %>
      <%= f.text_area :description, rows: 5, style: "width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 5px; font-size: 1em; background: var(--bg-tertiary); color: var(--text-primary);" %>
    </div>

    <% if @study_material.files.attached? %>
      <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Current Files:</h4>
        <% @study_material.files.each do |file| %>
          <div style="padding: 10px; background: var(--bg-secondary); margin-bottom: 8px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
            <div style="color: var(--text-primary);">
              <% if file.content_type == 'application/pdf' %>
                <span style="font-size: 1.2em;">üìÑ</span>
              <% elsif file.content_type.start_with?('image/') %>
                <span style="font-size: 1.2em;">üñºÔ∏è</span>
              <% else %>
                <span style="font-size: 1.2em;">üìé</span>
              <% end %>
              <strong style="margin-left: 8px;"><%= file.filename %></strong>
              <span style="color: var(--text-secondary); margin-left: 8px; font-size: 0.9em;">(<%= number_to_human_size(file.byte_size) %>)</span>
            </div>
            <%= link_to "<i class="fa-solid fa-trash"></i> Delete", remove_file_study_material_path(@study_material, file_id: file.id), method: :delete, data: { confirm: "Are you sure you want to delete this file?" }, style: "background: #e74c3c; color: white; padding: 6px 12px; border-radius: 5px; text-decoration: none; font-weight: bold; font-size: 0.9em;" %>
          </div>
        <% end %>
      </div>
    <% end %>

    <div style="margin-bottom: 20px;">
      <%= f.label :files, "Add New Files", style: "display: block; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;" %>
      <%= f.file_field :files, multiple: true, accept: "image/*,application/pdf", style: "width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary);" %>
      <small style="color: var(--text-secondary); display: block; margin-top: 5px;">New files will be added to existing files.</small>
    </div>

    <div style="display: flex; gap: 15px; margin-top: 30px;">
      <%= f.submit "Update", class: "btn btn-primary", style: "flex: 1; background: var(--accent-primary); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer;" %>
      <%= link_to "Cancel", study_materials_path, class: "btn btn-secondary", style: "flex: 1; text-align: center; background: var(--btn-secondary-bg); color: var(--btn-secondary-text); padding: 15px; border-radius: 8px; text-decoration: none; font-size: 1.1em; font-weight: bold; display: block;" %>
    </div>
  <% end %>
</div>

<script>
  // Theme switcher functionality
  function getTheme() {
    return localStorage.getItem('theme') || 'light';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButton(theme);
  }

  function updateThemeButton(theme) {
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    
    if (theme === 'dark') {
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
      themeText.textContent = 'Light';
    } else {
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
      themeText.textContent = 'Dark';
    }
  }

  function toggleTheme() {
    const currentTheme = getTheme();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
  }

  (function initTheme() {
    const savedTheme = getTheme();
    setTheme(savedTheme);
  })();
</script>
